<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seat Booking</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Overlay container for subtle background poster */
    #backgroundOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      filter: blur(8px) brightness(0.7);
      opacity: 0.5;
      transition: background-image 0.5s ease;
    }
    /* Seat map container */
    #seatMap {
      max-width: 370px;
      margin: 20px auto;
      background-color: rgba(255, 255, 255, 0.85);
      padding: 15px 12px;
      border-radius: 12px;
      display: grid;
      grid-template-columns: repeat(8, 40px);
      gap: 8px;
      justify-content: center;
    }
    /* Individual seat styles */
    .seat {
      width: 40px;
      height: 40px;
      background-color: gray;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }
    .seat.selected {
      background-color: green;
    }
    .seat.booked {
      background-color: red;
      cursor: not-allowed;
    }
    /* Booking info styling */
    #bookingInfo {
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 12px;
      border-radius: 8px;
      margin: 12px auto 20px auto;
      max-width: 320px;
      font-size: 18px;
      user-select: none;
      text-align: center;
    }
    /* Selected seats display */
    #selectedSeatsDisplay {
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      display: inline-block;
      min-width: 100px;
      font-weight: bold;
      user-select: none;
      text-align: center;
      margin: 0 auto 20px auto;
      max-width: 320px;
    }
    /* User name input */
    #userName {
      background-color: rgba(255, 255, 255, 0.9);
      color: #111;
      padding: 8px;
      font-size: 16px;
      width: 220px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin: 0 auto 20px auto;
      display: block;
      max-width: 320px;
    }
    /* Buttons */
    .btn {
      padding: 10px 15px;
      margin: 10px 5px;
      background-image: linear-gradient(90deg, #e50914 60%, #0c62fe 140%);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(229, 9, 20, 0.18);
      transition: background 0.19s, box-shadow 0.12s, transform 0.17s;
      user-select: none;
      display: inline-block;
      min-width: 140px;
      text-align: center;
    }
    .btn:hover {
      background-image: linear-gradient(90deg, #ff80ab 20%, #651fff 84%);
      box-shadow: 0 6px 28px #e040fb66, 0 1px 4px #0097a7bb;
      transform: translateY(-2.5px) scale(1.04);
    }
    /* Container */
    .booking-container {
      max-width: 400px;
      margin: 40px auto 60px auto;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Background overlay for subtle movie poster -->
  <div id="backgroundOverlay"></div>

  <div class="booking-container">
    <h2>Seat Booking</h2>

    <div id="bookingInfo">
      <!-- Movie, theater, date, time info will be injected here -->
    </div>

    <div id="seatMap"></div>

    <div id="selectedSeatsDisplay">Selected Seats: None</div>

    <input
      type="text"
      id="userName"
      placeholder="Enter your name"
      autocomplete="off"
    />

    <div>
      <button class="btn" onclick="confirmBooking()">Confirm Booking</button>
      <button class="btn" onclick="resetSelection()">Reset</button>
    </div>
  </div>

  <script>
    // Get booking info from localStorage
    const selectedMovie = localStorage.getItem("movie") || "No Movie Selected";
    const selectedTheater = localStorage.getItem("theater") || "No Theater Selected";
    const movieDate = localStorage.getItem("movieDate") || "N/A";
    const movieTime = localStorage.getItem("movieTime") || "N/A";

    // Display booking info text
    const bookingInfo = document.getElementById("bookingInfo");
    bookingInfo.innerHTML = `
      <strong>Movie:</strong> ${selectedMovie} &nbsp; | &nbsp;
      <strong>Theater:</strong> ${selectedTheater} &nbsp; | &nbsp;
      <strong>Date:</strong> ${movieDate} &nbsp; | &nbsp;
      <strong>Show Time:</strong> ${movieTime}
    `;

    // Movie poster URLs mapping
    const moviePosters = {
      RRR: "images/rrr.jpeg",
      KGF: "images/kgf.jpeg",
      Pushpa: "images/pushpa.jpeg",
      Inception: "images/inception.jpg",
      Avatar: "images/avatar.jpeg",
      "The Batman": "images/batman.jpeg",
      Vikram: "images/vikram.jpeg",
      Jailer: "images/jailer.jpg",
      Leo: "images/leo.jpg"
    };

    // Set overlay background image to the selected movie poster
    const overlay = document.getElementById("backgroundOverlay");
    const posterUrl = moviePosters[selectedMovie];

    if (posterUrl) {
      overlay.style.backgroundImage = `url('${posterUrl}')`;
      overlay.style.filter = "blur(8px) brightness(0.7)";
      overlay.style.opacity = "0.5";
    } else {
      overlay.style.backgroundImage = "none";
      overlay.style.filter = "none";
      overlay.style.opacity = "0";
    }

    // Seat booking setup
    const seatMap = document.getElementById("seatMap");
    const selectedSeatsDisplay = document.getElementById("selectedSeatsDisplay");
    const totalSeats = 40;
    const bookedSeatsKey = `bookedSeats_${selectedMovie}_${selectedTheater}`;
    let bookedSeats = JSON.parse(localStorage.getItem(bookedSeatsKey)) || [];
    let selectedSeats = [];

    function updateSelectedSeatsDisplay() {
      selectedSeatsDisplay.textContent = selectedSeats.length
        ? `Selected Seats: ${selectedSeats.sort((a,b) => a-b).join(", ")}`
        : "Selected Seats: None";
    }

    function renderSeats() {
      seatMap.innerHTML = "";
      for(let i = 1; i <= totalSeats; i++) {
        const seat = document.createElement("div");
        seat.className = "seat";
        seat.textContent = i;
        if(bookedSeats.includes(i)) seat.classList.add("booked");
        if(selectedSeats.includes(i)) seat.classList.add("selected");

        seat.addEventListener("click", () => {
          if(seat.classList.contains("booked")) return;
          if(seat.classList.contains("selected")) {
            seat.classList.remove("selected");
            selectedSeats = selectedSeats.filter(s => s !== i);
          } else {
            seat.classList.add("selected");
            selectedSeats.push(i);
          }
          updateSelectedSeatsDisplay();
        });

        seatMap.appendChild(seat);
      }
      updateSelectedSeatsDisplay();
    }

    window.confirmBooking = function() {
      if(selectedSeats.length === 0){
        alert("Please select at least one seat.");
        return;
      }
      const userNameInput = document.getElementById("userName");
      const userName = userNameInput.value.trim() || "Guest";

      bookedSeats = Array.from(new Set([...bookedSeats, ...selectedSeats]));
      localStorage.setItem(bookedSeatsKey, JSON.stringify(bookedSeats));

      localStorage.setItem("user", userName);
      localStorage.setItem("seats", selectedSeats.sort((a,b) => a-b).join(", "));
      localStorage.setItem("movieDate", movieDate);
      localStorage.setItem("movieTime", movieTime);

      // Redirect to payment page
      window.location.href = "payment.html";
    };

    window.resetSelection = function() {
      selectedSeats = [];
      document.getElementById("userName").value = "";
      renderSeats();
    };

    // Initialize seats on page load
    renderSeats();
  </script>
</body>
</html>
